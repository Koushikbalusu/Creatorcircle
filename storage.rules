rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // Allow authenticated users to upload to posts folder
    match /posts/{userId}/{postId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow authenticated users to upload profile images
    match /users/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow authenticated users to upload to profiles folder (alternative path)
    match /profiles/{userId}/{allPaths=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Allow test uploads for connectivity testing
    match /test/{allPaths=**} {
      allow read, write: if request.auth != null;
    }
    
    // üõ°Ô∏è MODERATION: Block inappropriate file names and content
    match /{allPaths=**} {
      allow read: if true;
      allow write: if request.auth != null && 
        !resource.name.matches('.*(nude|naked|porn|sex|adult|explicit|nsfw|xxx|fuck|shit|bitch|whore|slut|dick|penis|cock|pussy|vagina|boobs|tits|ass|butt|cum|masturbat|horny|erotic|sexy|intimate|fetish|bdsm|kinky|violence|violent|brutal|threat|attack|assault|hate|racist|nazi|hitler|fascist|gay|lesbian|transgender|faggot|dyke|tranny|retard|stupid|scam|fraud|illegal|criminal|cheat|fake|spam).*');
    }
  }
}
